# üîê SUPABASE SUBSCRIPTION VALIDATION - DESKTOP APP

## ‚úÖ **COMPLETE INTEGRATION GUIDE**

BeastBrowser ab Supabase se subscription validate karega!

---

## üéØ **KYA BANAYA:**

### **1. Subscription Validator** (`electron/subscription-validator.js`)
```javascript
- Supabase API call karta hai
- User ke subscription ko validate karta hai
- 5 minute cache (avoid too many API calls)
- Network error handling
```

### **2. IPC Handlers** (`electron/main.js`)
```javascript
- validateSubscription(userEmail)
- getSubscriptionDetails(userEmail)
- clearSubscriptionCache()
```

### **3. Preload API** (`electron/preload.js`)
```javascript
window.electronAPI.validateSubscription(email)
window.electronAPI.getSubscriptionDetails(email)
window.electronAPI.clearSubscriptionCache()
```

### **4. React Component** (`src/components/auth/SubscriptionGuard.tsx`)
```tsx
- Subscription check on app startup
- Beautiful error screens
- Auto-refresh every 5 minutes
- Purchase redirect
```

---

## üöÄ **KAISE USE KAREIN:**

### **STEP 1: Install Dependencies**

```bash
cd "C:\Users\sriva\Downloads\Telegram Desktop\new version\beastbrowser-main"
npm install axios
```

### **STEP 2: Update App.tsx**

**File:** `src/App.tsx`

```tsx
import { SubscriptionGuard } from './components/auth/SubscriptionGuard'
import { useSupabaseAuth } from './hooks/useSupabaseAuth'

function App() {
  const { user } = useSupabaseAuth()
  
  return (
    <SubscriptionGuard userEmail={user?.email || null}>
      {/* Your existing app content */}
      <ProfileManager />
      {/* ... */}
    </SubscriptionGuard>
  )
}
```

### **STEP 3: Set Environment Variable**

**Create:** `.env` file in root

```bash
SUPABASE_API_URL=https://your-website.com
```

**Or for localhost testing:**
```bash
SUPABASE_API_URL=http://localhost:3001
```

### **STEP 4: Update Website API** (Already Done!)

**File:** `webshiete/app/api/browser/validate-subscription/route.ts`

This endpoint already exists! ‚úÖ

---

## üîÑ **COMPLETE FLOW:**

### **App Startup:**

```
1. User opens BeastBrowser desktop app
   ‚Üì
2. SubscriptionGuard component loads
   ‚Üì
3. Checks if user is logged in
   ‚Üì
4. Calls: window.electronAPI.validateSubscription(email)
   ‚Üì
5. Electron main.js receives request
   ‚Üì
6. subscription-validator.js calls Supabase API
   ‚Üì
7. API: https://your-website.com/api/browser/validate-subscription
   ‚Üì
8. Supabase checks subscription table
   ‚Üì
9. Returns status:
   {
     hasSubscription: true/false,
     plan: "starter" / "monthly" / "yearly",
     expiresAt: "2025-10-15T18:40:00Z",
     daysRemaining: 1
   }
   ‚Üì
10. If valid ‚Üí App loads! ‚úÖ
11. If invalid ‚Üí Blocked screen shows! ‚ùå
```

---

## üìä **SUBSCRIPTION CHECK LOGIC:**

### **Starter Plan (24 Hours):**
```javascript
Created: 2025-10-14 18:40:00
Expires: 2025-10-15 18:40:00  // +24 hours

After 24 hours:
  ‚Üí status becomes 'expired'
  ‚Üí Desktop app blocks access
  ‚Üí User must purchase again
```

### **Monthly Plan:**
```javascript
Created: 2025-10-14
Expires: 2025-11-14  // +30 days
```

### **Yearly Plan:**
```javascript
Created: 2025-10-14
Expires: 2026-10-14  // +365 days
```

---

## üé® **UI SCREENS:**

### **Screen 1: Loading** (Checking subscription)
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                              ‚îÇ
‚îÇ         üõ°Ô∏è (pulsing)         ‚îÇ
‚îÇ                              ‚îÇ
‚îÇ  Verifying Subscription...   ‚îÇ
‚îÇ  Please wait...              ‚îÇ
‚îÇ                              ‚îÇ
‚îÇ      (spinner animation)     ‚îÇ
‚îÇ                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### **Screen 2: No Subscription** (Blocked)
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ          ‚ö†Ô∏è (red)            ‚îÇ
‚îÇ                              ‚îÇ
‚îÇ   Subscription Required      ‚îÇ
‚îÇ                              ‚îÇ
‚îÇ  Please purchase a plan to   ‚îÇ
‚îÇ  use BeastBrowser            ‚îÇ
‚îÇ                              ‚îÇ
‚îÇ  Logged in: user@email.com   ‚îÇ
‚îÇ                              ‚îÇ
‚îÇ  [Purchase Subscription]     ‚îÇ
‚îÇ  [Refresh Status]            ‚îÇ
‚îÇ                              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### **Screen 3: Active Subscription** (Banner)
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ üõ°Ô∏è Starter Plan Active ‚Ä¢ 1 day remaining ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
‚Üì
[Normal App Content]
```

---

## üß™ **TESTING:**

### **Test 1: Valid Subscription**
```bash
1. Login with email that HAS active subscription
2. Open BeastBrowser desktop app
3. Expected:
   ‚úÖ Green banner shows
   ‚úÖ "Starter/Monthly/Yearly Plan Active"
   ‚úÖ Days remaining shown
   ‚úÖ App fully accessible
```

### **Test 2: No Subscription**
```bash
1. Login with email that has NO subscription
2. Open BeastBrowser desktop app
3. Expected:
   ‚ùå Red error screen
   ‚ùå "Subscription Required"
   ‚ùå "Purchase Subscription" button
   ‚ùå App blocked
```

### **Test 3: Expired Subscription**
```bash
1. Buy Starter Plan (24hr)
2. Wait 24 hours (or manually update DB)
3. Reopen BeastBrowser
4. Expected:
   ‚ùå Subscription expired
   ‚ùå App blocked
   ‚ùå Must purchase again
```

### **Test 4: Offline Mode**
```bash
1. Disconnect internet
2. Open BeastBrowser
3. Expected:
   ‚ö†Ô∏è "Cannot Verify Subscription"
   ‚ö†Ô∏è Yellow warning banner
   ‚ö†Ô∏è Limited access message
```

---

## üîß **CUSTOMIZATION:**

### **Change Check Frequency:**

**File:** `src/components/auth/SubscriptionGuard.tsx`

```tsx
// Default: 5 minutes
const interval = setInterval(() => {
  checkSubscription(true)
}, 5 * 60 * 1000)

// Change to 10 minutes:
}, 10 * 60 * 1000)

// Change to 1 hour:
}, 60 * 60 * 1000)
```

### **Change Cache Timeout:**

**File:** `electron/subscription-validator.js`

```javascript
// Default: 5 minutes
this.cacheTimeout = 5 * 60 * 1000;

// Change to 10 minutes:
this.cacheTimeout = 10 * 60 * 1000;
```

### **Change Purchase URL:**

**File:** `src/components/auth/SubscriptionGuard.tsx`

```tsx
const openPurchasePage = () => {
  window.open('https://your-website.com/pricing', '_blank')
}

// Change to your actual URL:
window.open('https://beastbrowser.com/pricing', '_blank')
```

---

## üìù **FILES CREATED:**

```
‚úÖ electron/subscription-validator.js    (NEW - Validation logic)
‚úÖ src/components/auth/SubscriptionGuard.tsx  (NEW - React guard)
‚úÖ electron/main.js                      (UPDATED - IPC handlers)
‚úÖ electron/preload.js                   (UPDATED - API exposure)
‚úÖ SUPABASE_SUBSCRIPTION_INTEGRATION.md  (NEW - This guide)
```

---

## üåê **API ENDPOINT:**

**Already exists in your website!** ‚úÖ

**URL:** `https://your-website.com/api/browser/validate-subscription`

**Method:** POST

**Body:**
```json
{
  "email": "user@example.com"
}
```

**Response (Valid):**
```json
{
  "success": true,
  "hasSubscription": true,
  "plan": "starter",
  "subscriptionStatus": "active",
  "expiresAt": "2025-10-15T18:40:00Z",
  "daysRemaining": 1
}
```

**Response (Invalid):**
```json
{
  "success": false,
  "hasSubscription": false,
  "message": "No active subscription found"
}
```

---

## üö® **IMPORTANT NOTES:**

### **1. Environment Variable:**
```bash
# Must set this before building!
SUPABASE_API_URL=https://your-website.com
```

### **2. CORS Settings:**
```
Website API must allow requests from Electron app
(Usually not an issue with Electron, but worth noting)
```

### **3. Internet Dependency:**
```
App requires internet to validate subscription
Offline mode shows warning but can allow limited access
```

### **4. Security:**
```
- API endpoint validates on server-side
- Desktop app cannot bypass validation
- Subscription stored in Supabase (secure)
```

---

## üéØ **NEXT STEPS:**

### **1. Install Dependencies:**
```bash
npm install axios
```

### **2. Update App.tsx:**
```tsx
import { SubscriptionGuard } from './components/auth/SubscriptionGuard'

<SubscriptionGuard userEmail={user?.email}>
  <YourApp />
</SubscriptionGuard>
```

### **3. Set Environment Variable:**
```bash
# .env file
SUPABASE_API_URL=https://your-website.com
```

### **4. Test:**
```bash
npm run electron-dev
```

### **5. Build:**
```bash
npm run build:win
```

---

## ‚úÖ **VERIFICATION CHECKLIST:**

- [ ] axios installed (`npm install axios`)
- [ ] SubscriptionGuard imported in App.tsx
- [ ] SUPABASE_API_URL set in .env
- [ ] Website API endpoint working
- [ ] Tested with valid subscription
- [ ] Tested with no subscription
- [ ] Tested with expired subscription
- [ ] Tested offline mode
- [ ] Build successful
- [ ] Installer created

---

## üéâ **RESULT:**

### **Desktop App ab:**

‚úÖ Startup pe subscription check karega
‚úÖ Valid subscription ‚Üí Full access
‚ùå No subscription ‚Üí Blocked + purchase link
‚ö†Ô∏è Expired subscription ‚Üí Blocked + renew prompt
üîÑ Auto-refresh every 5 minutes
üìä Shows days remaining
üõ°Ô∏è Server-side validation (secure!)

---

## üìû **TROUBLESHOOTING:**

### **Issue 1: "Cannot connect to server"**
```
- Check SUPABASE_API_URL in .env
- Check internet connection
- Check website API is running
- Check CORS settings
```

### **Issue 2: "Validation failed"**
```
- Check user email is correct
- Check subscription exists in Supabase
- Check subscription is not expired
- Check API endpoint logs
```

### **Issue 3: App blocked even with subscription**
```
- Click "Refresh Status" button
- Clear cache: window.electronAPI.clearSubscriptionCache()
- Check Supabase subscription table
- Check expires_at date is in future
```

---

## üöÄ **READY TO USE!**

**Integration complete hai!**

**Ab test karo:**
1. Install axios
2. Update App.tsx
3. Set SUPABASE_API_URL
4. Run: `npm run electron-dev`
5. ‚úÖ Working!

**Happy coding!** üéâüîê
